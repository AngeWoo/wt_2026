<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¡ä¿®è¡Œåˆ®åˆ®æ¨‚ (4x4)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 600px; /* ç¨å¾®åŠ å¯¬ä»¥å®¹ç´4x4 */
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .scratch-card {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* --- ä¿®æ”¹è™•ï¼š3æ”¹ç‚º4 --- */
            gap: 10px;
            margin: 30px auto;
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .scratch-cell {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            cursor: crosshair;
            border: 2px solid #fff;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .prize-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .scratch-surface {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #C0C0C0, #808080);
            z-index: 10;
            cursor: crosshair;
        }

        .scratch-surface::before {
            content: "åˆ®";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 1.5em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        .controls {
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 0 10px;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 20px;
            font-size: 1.3em;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .result-main {
            font-size: 1em;
            color: #333;
            text-align: center;
        }

        .result-sub {
            font-size: 0.7em;
            color: #666;
            text-align: center;
            padding-top: 5px;
        }

        .win {
            color: #FF6B6B;
            animation: pulse 1s infinite;
        }

        .lose {
            color: #666;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .instructions {
            margin-top: 20px;
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .prize-amounts {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        /* å¤§ä¹˜ä¹‹é“æŠ½ç±¤è¦–çª— */
        .mahayana-modal {
            z-index: 2000;
        }

        /* æ³•æ¯åä¸ƒè¨“è¦–çª— */
        .chance-modal {
            z-index: 2100;
        }

        .chance-modal .modal-content {
            border: 3px solid #27ae60;
            box-shadow: 0 20px 60px rgba(39, 174, 96, 0.3);
        }

        .chance-modal .modal-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            margin: -30px -30px 20px -30px;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            text-align: center;
        }

        .chance-modal .modal-header h3 {
            margin: 0;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .chance-modal .modal-body {
            line-height: 1.6;
            font-size: 1.1em;
            text-align: center;
        }

        .chance-modal .modal-body #chanceMessage {
            font-style: italic;
            color: #2c3e50;
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
            margin-bottom: 15px;
        }

        .chance-modal .encouragement {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 8px;
            color: #27ae60;
            font-weight: bold;
            border: 2px solid #27ae60;
        }

        .chance-modal .btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            margin-top: 20px;
        }

        /* æ‹”è‹¦ä»£å—éˆè¨“è¦–çª— */
        .destiny-modal {
            z-index: 2100;
        }

        .destiny-modal .modal-content {
            border: 3px solid #8e44ad;
            box-shadow: 0 20px 60px rgba(142, 68, 173, 0.3);
        }

        .destiny-modal .modal-header {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            margin: -30px -30px 20px -30px;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            text-align: center;
        }

        .destiny-modal .modal-header h3 {
            margin: 0;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .destiny-modal .modal-body {
            line-height: 1.6;
            font-size: 1.1em;
            text-align: center;
        }

        .destiny-modal .modal-body #destinyMessage {
            font-style: italic;
            color: #2c3e50;
            background: #f4f1f8;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #8e44ad;
            margin-bottom: 15px;
        }

        .destiny-modal .encouragement {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 8px;
            color: #8e44ad;
            font-weight: bold;
            border: 2px solid #8e44ad;
        }

        .destiny-modal .btn {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            margin-top: 20px;
        }

        /* è‹‘å²æŠ½ç±¤è¦–çª— */
        .history-modal {
            z-index: 2200;
        }

        .history-modal .modal-content {
            border: 3px solid #e74c3c;
            box-shadow: 0 20px 60px rgba(231, 76, 60, 0.3);
            max-width: 600px;
            width: 95%;
        }

        .history-modal .modal-header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            margin: -30px -30px 20px -30px;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            text-align: center;
        }

        .history-modal .modal-header h3 {
            margin: 0;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .history-modal .modal-body {
            line-height: 1.6;
            font-size: 1.1em;
            text-align: center;
        }

        .history-modal .modal-body #historyMessage {
            color: #2c3e50;
            background: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            margin-bottom: 15px;
            text-align: left;
        }

        .history-modal .encouragement {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 8px;
            color: #e74c3c;
            font-weight: bold;
            border: 2px solid #e74c3c;
        }

        .history-modal .btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            margin-top: 20px;
        }

        .mahayana-modal .modal-content {
            border: 3px solid #d35400;
            box-shadow: 0 20px 60px rgba(211, 84, 0, 0.3);
        }

        .mahayana-modal .modal-header {
            background: linear-gradient(135deg, #d35400, #e67e22);
            color: white;
            margin: -30px -30px 20px -30px;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            text-align: center;
        }

        .mahayana-modal .modal-header h3 {
            margin: 0;
            font-size: 1.5em;
        }

        .mahayana-modal .modal-body {
            line-height: 1.6;
            font-size: 1.1em;
            text-align: center;
        }

        .mahayana-modal .modal-body hr {
            margin: 20px 0;
            border: none;
            border-top: 2px solid #ecf0f1;
        }

        .mahayana-modal .modal-body #mahayanaMessage {
            font-style: italic;
            color: #2c3e50;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d35400;
        }

        .mahayana-modal .btn {
            background: linear-gradient(135deg, #d35400, #e67e22);
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>æ­¡ä¿®è¡Œåˆ®åˆ®æ¨‚</h1>
        
        <div class="prize-amounts">
            <div>ğŸ“… 0328</div>
            <div>ğŸ“… 0509</div>
            <div>ğŸ“… 0806</div>
            <div>ğŸ“… 0719</div>
            <div>ğŸ“… 0408</div>
            <div>ğŸ“… 0702</div>
            <div>ğŸ“… 0609</div>
            <div></div>
            <div></div>
        </div>
        
        <div class="scratch-card" id="scratchCard">
            <!-- 16å®®æ ¼å°‡ç”±JavaScriptç”Ÿæˆ -->
        </div>

        <div class="result" id="result">
            ç”¨æ»‘é¼ åˆ®é–‹æ ¼å­ï¼Œçœ‹çœ‹ä½ çš„å¹¸é‹æ•¸å­—ï¼
        </div>

        <div class="controls">
            <button class="btn" onclick="resetGame()">ğŸ² é‡æ–°é–‹å§‹</button>
            <button class="btn" onclick="revealAll()">ğŸ‘ï¸ å…¨éƒ¨é¡¯ç¤º</button>
        </div>

        <div class="instructions">
            <p>ğŸ¯ éŠæˆ²è¦å‰‡ï¼šå¿…é ˆåˆ®æ»¿8å€‹æ ¼å­æ‰é–‹ç</p> <!-- --- ä¿®æ”¹è™•ï¼š6æ”¹ç‚º8 --- -->
            <p>ğŸ† ä¸‰å€‹ç›¸åŒæ•¸å­—ï¼šæ³•æ¯åä¸ƒè¨“</p>
            <p>ğŸ’« å››å€‹ç›¸åŒæ•¸å­—ï¼šæ‹”è‹¦ä»£å—éˆè¨“ï¼ˆå¤§çï¼‰</p>
            <p>ğŸ“œ äº”å€‹ä»¥ä¸Šç›¸åŒï¼šè‹‘å²æŠ½ç±¤ï¼ˆè¶…ç´šå¤§çï¼‰</p>
            <p>ğŸ’¡ é»æ“Šæ ¼å­å³å¯åˆ®é–‹</p>
            <p>ğŸ² æ²’ä¸­çå¯é‡æ–°é–‹å§‹æˆ–æŸ¥çœ‹å…¨éƒ¨</p>
        </div>
    </div>

    <!-- æ³•æ¯åä¸ƒè¨“Modal -->
    <div id="chanceModal" class="modal chance-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’« æ³•æ¯åä¸ƒè¨“</h3>
            </div>
            <div class="modal-body">
                <div id="chanceMessage">
                    æ­£åœ¨ç²å–æ³•æ¯æŒ‡å¼•...
                </div>
                <div class="encouragement">
                    ğŸŒŸ æ­å–œä¸­çï¼ä»Šå¤©å°±æœå‘é€™å€‹ç¾å¥½çš„æ–¹å‘é‚é€²å§ï¼
                </div>
            </div>
            <button class="btn" onclick="closeChanceModal()">
                æ„Ÿæ©æ¥å—
            </button>
        </div>
    </div>

    <!-- æ‹”è‹¦ä»£å—éˆè¨“Modal -->
    <div id="destinyModal" class="modal destiny-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’œ æ‹”è‹¦ä»£å—éˆè¨“</h3>
            </div>
            <div class="modal-body">
                <div id="destinyMessage">
                    æ­£åœ¨ç²å–éˆæ€§æŒ‡å¼•...
                </div>
                <div class="encouragement">
                    âœ¨ ä¸­çæ˜¯ç¦å ±çš„é«”ç¾ï¼è®“æˆ‘å€‘ä»¥é€™ä»½æŒ‡å¼•é–‹å•Ÿç¾å¥½çš„ä¸€å¤©ï¼
                </div>
            </div>
            <button class="btn" onclick="closeDestinyModal()">
                æ„Ÿæ©æ¥å—
            </button>
        </div>
    </div>

    <!-- è‹‘å²æŠ½ç±¤Modal -->
    <div id="historyModal" class="modal history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“œ è‹‘å²æŠ½ç±¤</h3>
            </div>
            <div class="modal-body">
                <div id="historyMessage">
                    æ­£åœ¨æ™‚å…‰æ©Ÿä¸­ç©¿æ¢­ï¼Œå°‹æ‰¾æ­·å²è¨˜æ†¶...
                </div>
                <div class="encouragement">
                    ğŸŒŸ è¶…ç´šå¤§çï¼æ­·å²çš„æ™ºæ…§ç‚ºæ‚¨é»äº®å‰è·¯ï¼
                </div>
            </div>
            <button class="btn" onclick="closeHistoryModal()">
                æ„Ÿæ©æ­·å²
            </button>
        </div>
    </div>

    <!-- å¤§ä¹˜ä¹‹é“æŠ½ç±¤Modal -->
    <div id="mahayanaModal" class="modal mahayana-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“¿ å¤§ä¹˜ä¹‹é“</h3>
            </div>
            <div class="modal-body">
                <p style="font-weight: bold; color: #d35400; font-size: 1.2em; margin-bottom: 15px;">
                    æ‚¨çš„åŠŸå¾·ç´¯ç©ä¸è¶³ï¼Œè«‹ä½œå¤§ä¹˜åˆ©ä»–ä¹‹ä¿®è¡Œ
                </p>
                <hr>
                <div id="mahayanaMessage">
                    æ­£åœ¨ç²å–ä¿®è¡ŒæŒ‡å¼•...
                </div>
            </div>
            <button class="btn" onclick="closeMahayanaModal()">
                éµå¾ªæ•™èª¨
            </button>
        </div>
    </div>

    <script>
        // æ•¸å­—æ± 
        const numberPool = ["0328", "0509", "0806", "0719", "0408", "0702", "0609"];
        
        // æŠ½ç±¤è³‡æ–™ä¾†æº
        const motherMessagesSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEWDc6xiRT1fIynaHGScq18jeolq6GNp4Xdyp-UtH7BfG198FTeSBMC3_WImR8ZFqZCHX4r7hQf0UW/pub?gid=0&single=true&output=csv';
        const bakudaishouSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTQp08ZcC5kK1DRs8jE0FYXwmFLh5wXTxJZgdjuOK8s_UIcovZaqKqJhRIAa-Qz3yh5O80cs55euiKp/pub?gid=0&single=true&output=csv';
        const mahayanaSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSmsbivmJSOlSU040kBg0FLr7MglWgV8GFGBpRBuCRah36LH__sp8fgfzHiASonM5d74ysM7qIY9EbL/pub?gid=0&single=true&output=csv';
        const historySheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSELNOgRozrKO1bscsHe6doF8rH9-wSPYgvkhR5xXGhHKYvKoiXnlEC8YR3G5pPwQ2YFOksnlxYAQx-/pub?gid=0&single=true&output=csv';
        
        let motherMessagesData = [];
        let bakudaishouData = [];
        let mahayanaData = [];
        let historyData = [];

        // --- ä¿®æ”¹è™•ï¼šéŠæˆ²åƒæ•¸ ---
        const GRID_SIZE = 16;
        const MAX_SCRATCH = 8;

        let gameData = {
            prizes: [],
            scratchedCells: [],
            gameOver: false,
            scratchCount: 0,
            maxScratch: MAX_SCRATCH
        };

        function initGame() {
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            gameData = {
                prizes: [],
                scratchedCells: new Array(GRID_SIZE).fill(false), // ä½¿ç”¨GRID_SIZE
                gameOver: false,
                scratchCount: 0,
                maxScratch: MAX_SCRATCH // ä½¿ç”¨MAX_SCRATCH
            };

            // ç”Ÿæˆçé‡‘
            generatePrizes();
            
            // å‰µå»ºå®®æ ¼
            createScratchCard();
            
            // é‡ç½®çµæœé¡¯ç¤º
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = `
                <div class="result-main">é»æ“Šæ ¼å­ï¼Œçœ‹çœ‹ä½ çš„å¹¸é‹æ•¸å­—ï¼</div>
                <div class="result-sub">å‰©é¤˜åˆ®çæ¬¡æ•¸ï¼š${gameData.maxScratch}</div>
            `;
            resultElement.className = 'result';
        }

        function generatePrizes() {
            // æé«˜ä¸­çæ©Ÿç‡
            const winChance = Math.random();
            
            if (winChance < 0.65) {
                // 65% æ©Ÿç‡ç²å¾—ä¸‰å€‹ç›¸åŒï¼ˆæ³•æ¯åä¸ƒè¨“ï¼‰
                const winNumber = numberPool[Math.floor(Math.random() * numberPool.length)];
                const positions = getRandomPositions(3);
                
                for (let i = 0; i < GRID_SIZE; i++) { // --- ä¿®æ”¹è™•ï¼š9æ”¹ç‚ºGRID_SIZE ---
                    if (positions.includes(i)) {
                        gameData.prizes[i] = winNumber;
                    } else {
                        gameData.prizes[i] = numberPool[Math.floor(Math.random() * numberPool.length)];
                    }
                }
            } else if (winChance < 0.95) {
                // 30% æ©Ÿç‡ç²å¾—å››å€‹ç›¸åŒï¼ˆæ‹”è‹¦ä»£å—éˆè¨“ï¼‰- å¤§å¹…æå‡ï¼
                const winNumber = numberPool[Math.floor(Math.random() * numberPool.length)];
                const positions = getRandomPositions(4);
                
                for (let i = 0; i < GRID_SIZE; i++) { // --- ä¿®æ”¹è™•ï¼š9æ”¹ç‚ºGRID_SIZE ---
                    if (positions.includes(i)) {
                        gameData.prizes[i] = winNumber;
                    } else {
                        gameData.prizes[i] = numberPool[Math.floor(Math.random() * numberPool.length)];
                    }
                }
            } else {
                // åƒ…5% æ©Ÿç‡ä¸ä¸­çï¼ˆè§¸ç™¼å¤§ä¹˜ä¹‹é“ï¼‰
                for (let i = 0; i < GRID_SIZE; i++) { // --- ä¿®æ”¹è™•ï¼š9æ”¹ç‚ºGRID_SIZE ---
                    gameData.prizes[i] = numberPool[Math.floor(Math.random() * numberPool.length)];
                }
            }
        }

        function getRandomPositions(count) {
            const positions = [];
            while (positions.length < count) {
                const pos = Math.floor(Math.random() * GRID_SIZE); // --- ä¿®æ”¹è™•ï¼š9æ”¹ç‚ºGRID_SIZE ---
                if (!positions.includes(pos)) {
                    positions.push(pos);
                }
            }
            return positions;
        }

        function createScratchCard() {
            const card = document.getElementById('scratchCard');
            card.innerHTML = '';

            for (let i = 0; i < GRID_SIZE; i++) { // --- ä¿®æ”¹è™•ï¼š9æ”¹ç‚ºGRID_SIZE ---
                const cell = document.createElement('div');
                cell.className = 'scratch-cell';
                cell.dataset.index = i;

                const prizeContent = document.createElement('div');
                prizeContent.className = 'prize-content';
                prizeContent.style.background = getPrizeColor(gameData.prizes[i]);
                prizeContent.textContent = gameData.prizes[i];

                const scratchSurface = document.createElement('div');
                scratchSurface.className = 'scratch-surface';

                cell.appendChild(prizeContent);
                cell.appendChild(scratchSurface);
                card.appendChild(cell);

                // æ·»åŠ åˆ®çäº‹ä»¶
                addScratchEvents(cell, i);
            }
        }

        function getPrizeColor(number) {
            // æ ¹æ“šä¸åŒæ•¸å­—çµ¦äºˆä¸åŒé¡è‰²
            const colorMap = {
                "0328": 'linear-gradient(45deg, #FF6B6B, #FF8E8E)',
                "0509": 'linear-gradient(45deg, #4ECDC4, #7FDBDA)', 
                "0806": 'linear-gradient(45deg, #95E1D3, #B8E6D9)',
                "0719": 'linear-gradient(45deg, #FFD93D, #FFE55C)',
                "0408": 'linear-gradient(45deg, #A8E6CF, #C4F2E0)',
                "0702": 'linear-gradient(45deg, #FFB3BA, #FFC9CE)',
                "0609": 'linear-gradient(45deg, #C7CEEA, #E0E6FF)'
            };
            return colorMap[number] || 'linear-gradient(45deg, #D3D3D3, #E8E8E8)';
        }

        function addScratchEvents(cell, index) {
            const surface = cell.querySelector('.scratch-surface');

            // æª¢æŸ¥æ˜¯å¦é‚„èƒ½åˆ®ç
            function canScratch() {
                return gameData.scratchCount < gameData.maxScratch && !gameData.scratchedCells[index] && !gameData.gameOver;
            }

            // æ»‘é¼ é»æ“Šäº‹ä»¶ - é»æ“Šä¸€ä¸‹å³å¯åˆ®é–‹
            surface.addEventListener('click', (e) => {
                if (!canScratch()) return;
                e.preventDefault();
                scratchCell(surface, index);
            });

            // è§¸æ§é»æ“Šäº‹ä»¶
            surface.addEventListener('touchstart', (e) => {
                if (!canScratch()) return;
                e.preventDefault();
                scratchCell(surface, index);
            });
        }
        
        function scratchCell(surface, index) {
            if (gameData.scratchedCells[index]) return;

            gameData.scratchedCells[index] = true;
            gameData.scratchCount++;
            
            updateScratchCounter();

            surface.style.transition = 'opacity 0.8s ease-out';
            surface.style.opacity = '0';
            
            setTimeout(() => {
                surface.style.display = 'none';
            }, 800);

            checkWinCondition();
        }

        function updateScratchCounter() {
            const remaining = gameData.maxScratch - gameData.scratchCount;
            const result = document.getElementById('result');
            
            if (remaining > 0 && !gameData.gameOver) {
                result.innerHTML = `
                    <div class="result-main">ç¹¼çºŒåˆ®çï¼</div>
                    <div class="result-sub">å‰©é¤˜åˆ®çæ¬¡æ•¸ï¼š${remaining}</div>
                `;
            } else if (remaining === 0 && !gameData.gameOver) {
                result.innerHTML = `
                    <div class="result-main">å·²åˆ®æ»¿${gameData.maxScratch}å€‹æ ¼å­ï¼Œé–‹å§‹é–‹çï¼</div>
                    <div class="result-sub">æ­£åœ¨æª¢æŸ¥ä¸­ççµæœ...</div>
                `;
            }
        }

        function checkWinCondition() {
            if (gameData.scratchCount < gameData.maxScratch) {
                return; 
            }

            gameData.gameOver = true; 

            const amounts = {};
            gameData.prizes.forEach((prize, index) => {
                if (gameData.scratchedCells[index]) {
                    amounts[prize] = (amounts[prize] || 0) + 1;
                }
            });

            let maxCount = 0;
            let winningNumber = "";
            
            for (const [number, count] of Object.entries(amounts)) {
                if (count > maxCount) {
                    maxCount = count;
                    winningNumber = number;
                }
            }

            if (maxCount >= 5) {
                setTimeout(() => {
                    showResult(`ğŸ‰ è¶…ç´šå¤§çï¼${maxCount}å€‹ ${winningNumber} ğŸ‰`, 'win');
                    setTimeout(() => {
                        showHistoryModal();
                    }, 1500);
                }, 1000);
                return;
            } else if (maxCount >= 4) {
                setTimeout(() => {
                    showResult(`ğŸ‰ å¤§çï¼å››å€‹ ${winningNumber} ğŸ‰`, 'win');
                    setTimeout(() => {
                        showDestinyModal();
                    }, 1500);
                }, 1000);
                return;
            } else if (maxCount >= 3) {
                setTimeout(() => {
                    showResult(`ğŸ‰ æ­å–œä¸­çï¼ä¸‰å€‹ ${winningNumber} ğŸ‰`, 'win');
                    setTimeout(() => {
                        showChanceModal();
                    }, 1500);
                }, 1000);
                return;
            } else {
                setTimeout(() => {
                    showResult('æ‚¨çš„åŠŸå¾·ç´¯ç©ä¸è¶³ï¼Œè«‹ä½œå¤§ä¹˜åˆ©ä»–ä¹‹ä¿®è¡Œ', 'lose');
                    updateControls();
                    setTimeout(() => {
                        showMahayanaModal();
                    }, 800);
                }, 1000);
            }
        }

        function updateControls() {
            const controls = document.querySelector('.controls');
            controls.innerHTML = `
                <button class="btn" onclick="resetGame()">ğŸ² é‡æ–°é–‹å§‹</button>
                <button class="btn" onclick="revealAll()">ğŸ‘ï¸ å…¨éƒ¨é¡¯ç¤º</button>
            `;
        }

        function showResult(message, className) {
            const result = document.getElementById('result');
            result.innerHTML = `<div class="result-main">${message}</div>`;
            result.className = `result ${className}`;
        }

        function resetGame() {
            initGame();
        }

        function revealAll() {
            const surfaces = document.querySelectorAll('.scratch-surface');
            surfaces.forEach((surface, index) => {
                surface.style.transition = 'opacity 0.5s ease-out';
                surface.style.opacity = '0';
                setTimeout(() => {
                    surface.style.display = 'none';
                }, 500);
                gameData.scratchedCells[index] = true;
            });
            
            gameData.gameOver = true;
            
            setTimeout(() => {
                const amounts = {};
                gameData.prizes.forEach((prize) => {
                    amounts[prize] = (amounts[prize] || 0) + 1;
                });

                let maxCount = 0;
                let winningNumber = "";
                
                for (const [number, count] of Object.entries(amounts)) {
                    if (count >= 3 && count > maxCount) {
                        maxCount = count;
                        winningNumber = number;
                    }
                }
                
                if (maxCount >= 5) {
                     showResult(`ğŸ‰ å…¨éƒ¨é¡¯ç¤ºï¼šä½ æœ¬ä¾†å¯ä»¥ä¸­è¶…ç´šå¤§ç ${winningNumber}ï¼ˆ${maxCount}å€‹ï¼‰ï¼`, 'win');
                } else if (maxCount >= 4) {
                    showResult(`ğŸ‰ å…¨éƒ¨é¡¯ç¤ºï¼šä½ æœ¬ä¾†å¯ä»¥ä¸­å¤§ç ${winningNumber}ï¼ˆå››å€‹ï¼‰ï¼`, 'win');
                } else if (maxCount >= 3) {
                    showResult(`ğŸ‰ å…¨éƒ¨é¡¯ç¤ºï¼šä½ æœ¬ä¾†å¯ä»¥ä¸­ç ${winningNumber}ï¼ˆä¸‰å€‹ï¼‰ï¼`, 'win');
                } else {
                    showResult('ğŸ˜” å…¨éƒ¨é¡¯ç¤ºï¼šé€™å¼µåˆ®åˆ®æ¨‚æ²’æœ‰ä¸­ç', 'lose');
                }
                updateControls();
            }, 600);
        }

        // åˆå§‹åŒ–éŠæˆ²
        initGame();
        
        // è¼‰å…¥æ‰€æœ‰æŠ½ç±¤è³‡æ–™
        fetchMotherMessages();
        fetchBakudaishouMessages();
        fetchMahayanaMessages();
        fetchHistoryMessages();
        
        async function fetchSheetData(url, dataArray, fallbackMessage) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network error');
                const text = await response.text();
                
                const messages = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0 && line !== 'Content' && line !== 'Content\r');
                
                if (messages.length > 0) {
                    dataArray.push(...messages);
                } else {
                    dataArray.push(fallbackMessage);
                }
            } catch (error) {
                console.error('ç„¡æ³•è¼‰å…¥è³‡æ–™:', url, error);
                dataArray.push(fallbackMessage);
            }
        }
        
        function fetchMotherMessages() {
            fetchSheetData(motherMessagesSheetUrl, motherMessagesData, "ç¥ç¦èˆ‡æ‚¨åŒåœ¨ã€‚");
        }
        
        function fetchBakudaishouMessages() {
            fetchSheetData(bakudaishouSheetUrl, bakudaishouData, "ä¸Šå¤©æ…ˆæ‚²ï¼Œæ‚¨çš„è‹¦å„å·²è¢«åˆ†æ“”ã€‚");
        }
        
        function fetchMahayanaMessages() {
           fetchSheetData(mahayanaSheetUrl, mahayanaData, "æ‚¨çš„åŠŸå¾·é‡‘ä¸å¤ ,ä»Šå¤©è«‹åšå¤§ä¹˜åˆ©ä»–å¥‰ä»•ä¿®è¡Œ");
        }
        
        function fetchHistoryMessages() {
            fetchSheetData(historySheetUrl, historyData, "æ­·å²çš„æ™ºæ…§ï¼Œæºé æµé•·ã€‚");
        }

        function showChanceModal() {
            const chanceMessage = document.getElementById('chanceMessage');
            if (motherMessagesData.length > 0) {
                const randomIndex = Math.floor(Math.random() * motherMessagesData.length);
                chanceMessage.innerHTML = motherMessagesData[randomIndex];
            } else {
                chanceMessage.innerHTML = "ç¥ç¦èˆ‡æ‚¨åŒåœ¨ã€‚";
            }
            document.getElementById('chanceModal').style.display = 'flex';
        }
        
        function closeChanceModal() {
            document.getElementById('chanceModal').style.display = 'none';
            const result = document.getElementById('result');
            result.innerHTML = `
                <div class="result-main">ğŸŒŸ æ­å–œä¸­çï¼æ³•æ¯æŒ‡å¼•å·²æ”¶åˆ°</div>
                <div class="result-sub">å¸¶è‘—é€™ä»½ç¥ç¦é–‹å§‹ç¾å¥½çš„ä¸€å¤©</div>
            `;
            const controls = document.querySelector('.controls');
            controls.innerHTML = `
                <button class="btn" onclick="resetGame()" style="background: linear-gradient(135deg, #27ae60, #229954);">
                    ğŸ² å†æ¬¡ç¥ˆç¦
                </button>
                <button class="btn" onclick="revealAll()" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    ğŸ‘ï¸ æŸ¥çœ‹å…¨éƒ¨
                </button>
            `;
        }
        
        function showDestinyModal() {
            const destinyMessage = document.getElementById('destinyMessage');
            if (bakudaishouData.length > 0) {
                const randomMessage = bakudaishouData[Math.floor(Math.random() * bakudaishouData.length)];
                destinyMessage.innerHTML = randomMessage;
            } else {
                destinyMessage.innerHTML = "ä¸Šå¤©æ…ˆæ‚²ï¼Œæ‚¨çš„è‹¦å„å·²è¢«åˆ†æ“”ã€‚";
            }
            document.getElementById('destinyModal').style.display = 'flex';
        }
        
        function closeDestinyModal() {
            document.getElementById('destinyModal').style.display = 'none';
            const result = document.getElementById('result');
            result.innerHTML = `
                <div class="result-main">ğŸ’œ è«‹åŠ æ²¹ï¼ä»Šå¤©è«‹åŠªåŠ›å¯¦è¸</div>
                <div class="result-sub">è®“é€™ä»½æ…ˆæ‚²ä¼´éš¨æ‚¨çš„æ¯ä¸€å¤©</div>
            `;
            const controls = document.querySelector('.controls');
            controls.innerHTML = `
                <button class="btn" onclick="resetGame()" style="background: linear-gradient(135deg, #8e44ad, #9b59b6);">
                    ğŸ² å†æ¬¡ç¥ˆç¦
                </button>
                <button class="btn" onclick="revealAll()" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    ğŸ‘ï¸ æŸ¥çœ‹å…¨éƒ¨
                </button>
            `;
        }
        
        function showMahayanaModal() {
            const mahayanaMessage = document.getElementById('mahayanaMessage');
            if (mahayanaData.length > 0) {
                const randomMessage = mahayanaData[Math.floor(Math.random() * mahayanaData.length)];
                mahayanaMessage.innerHTML = randomMessage;
            } else {
                mahayanaMessage.innerHTML = "æ‚¨çš„åŠŸå¾·é‡‘ä¸å¤ ,ä»Šå¤©è«‹åšå¤§ä¹˜åˆ©ä»–å¥‰ä»•ä¿®è¡Œ";
            }
            document.getElementById('mahayanaModal').style.display = 'flex';
        }
        
        function closeMahayanaModal() {
            document.getElementById('mahayanaModal').style.display = 'none';
            const result = document.getElementById('result');
            result.innerHTML = `
                <div class="result-main">ğŸ™ ä¿®è¡Œåœ“æ»¿ï¼ŒåŠŸå¾·å·²ç´¯ç©</div>
                <div class="result-sub">å¯é‡æ–°é–‹å§‹æˆ–æŸ¥çœ‹å…¨éƒ¨æ•¸å­—</div>
            `;
            const controls = document.querySelector('.controls');
            controls.innerHTML = `
                <button class="btn" onclick="resetGame()" style="background: linear-gradient(135deg, #27ae60, #229954);">
                    ğŸ² é‡æ–°ä¿®è¡Œ
                </button>
                <button class="btn" onclick="revealAll()" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    ğŸ‘ï¸ æŸ¥çœ‹å…¨éƒ¨
                </button>
            `;
        }

        function showHistoryModal() {
            const historyMessage = document.getElementById('historyMessage');
            if (historyData.length > 0) {
                const randomMessage = historyData[Math.floor(Math.random() * historyData.length)];
                historyMessage.innerHTML = randomMessage.replace(/\\n/g, '<br>');
            } else {
                historyMessage.innerHTML = "æ­·å²çš„æ™ºæ…§ï¼Œæºé æµé•·ã€‚";
            }
            document.getElementById('historyModal').style.display = 'flex';
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
            const result = document.getElementById('result');
            result.innerHTML = `
                <div class="result-main">ğŸ“œ è¶…ç´šå¤§çï¼æ­·å²çš„æ™ºæ…§èˆ‡æ‚¨åŒåœ¨ï¼</div>
                <div class="result-sub">è®“æ­·å²çš„å…‰è¼ç…§äº®æ‚¨çš„é“è·¯</div>
            `;
            const controls = document.querySelector('.controls');
            controls.innerHTML = `
                <button class="btn" onclick="resetGame()" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                    ğŸ² å†æ¬¡ç¥ˆç¦
                </button>
                <button class="btn" onclick="revealAll()" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    ğŸ‘ï¸ æŸ¥çœ‹å…¨éƒ¨
                </button>
            `;
        }
    </script>
</body>
</html>